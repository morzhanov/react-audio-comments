!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):e["react-media-editor"]=t(e.React)}(this,function(c){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?p(e):t}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}c=c&&c.hasOwnProperty("default")?c.default:c;var m=function(e){function t(e){var l;return i(this,t),u(p(p(l=h(this,d(t).call(this,e)))),"changeSize",function(){l.setState(function(e){return{width:l.canvas.current.offsetWidth,height:l.canvas.current.offsetWidth/e.ratio}});var t=l.canvas.current.parentNode;setTimeout(function(){t&&l.setState(function(e){return{width:t.offsetWidth,height:t.offsetWidth/e.ratio}}),l.state.data&&l.drawData(l.state.data),l.forceUpdate()},300)}),u(p(p(l)),"drawData",function(e){var t=l.state,o=t.width,a=t.height,i=t.stepHeight,n=t.maxSteps,s=p(p(l)).canvas.current.getContext("2d"),c=e.getChannelData(0);if(c.length>2*n){var r=~~(c.length/n);c=c.filter(function(e,t){return t%r==0})}s.save(),s.fillStyle="#000",s.lineWidth=1,s.fillRect(0,0,o,a),s.strokeStyle="#228",s.globalCompositeOperation="lighter",s.translate(0,a/2),s.globalAlpha=.6,c.forEach(function(e,t){var n=Math.floor(o*t/c.length),r=e*a/(1/i*.5);s.beginPath(),s.moveTo(n,0),s.lineTo(n+1,r),s.stroke()}),s.restore()}),u(p(p(l)),"drawProgress",function(e){var t=l.state,n=t.width,r=t.height,o=p(p(l)).canvas.current.getContext("2d");o.font="".concat(r/20,"px Arial"),o.fillStyle="#fff",o.textAlign="center",o.fillText(e,n/2,r/20),o.strokeStyle="#fff",o.lineWidth=2,o.beginPath(),o.moveTo(n*e/100,0),o.lineTo(n*e/100,r),o.stroke()}),u(p(p(l)),"mouseDownHandler",function(e){var t=e.nativeEvent.offsetX/e.target.offsetWidth;l.props.progressClickHandler(t)}),l.state={width:e.width,height:e.width/e.ratio,stepHeight:e.stepHeight,data:null,maxSteps:e.maxSteps,ratio:e.ratio},l.canvas=c.createRef(),l}return o(t,c.Component),n(t,[{key:"componentDidMount",value:function(){var t=this;window.AudioContext=window.AudioContext||window.webkitAudioContext;var e,n,r=new AudioContext,o=function(){console.log("error while decoding your file.")};e=this.props.src,(n=new XMLHttpRequest).open("GET",e,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){4===n.readyState&&(200===n.status?r.decodeAudioData(n.response,function(e){t.setState({data:e}),t.drawData(e)},o):console.log("error during the load.Wrong url or cross origin issue"))},n.send(),this.changeSize(),window.addEventListener("resize",this.changeSize)}},{key:"shouldComponentUpdate",value:function(e){return e.progress!==this.props.progress&&this.state.data&&(this.drawData(this.state.data),this.drawProgress(e.progress)),e}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.changeSize)}},{key:"render",value:function(){return c.createElement("canvas",{width:this.state.width,height:this.state.height,onMouseDown:this.mouseDownHandler,ref:this.canvas,style:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(e){u(t,e,n[e])})}return t}({display:"block",touchAction:"none"},this.props.style)})}}]),t}();u(m,"defaultProps",{width:800,ratio:3,stepHeight:4,maxSteps:8e3});var f=function(e){var t=e.width,n=e.height,r=e.style;return c.createElement("svg",{width:t,height:n,style:r,viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg"},c.createElement("path",{d:"M1664 192v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45zm-896 0v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45z"}))},g=function(e){var t=e.width,n=e.height,r=e.style;return c.createElement("svg",{width:t,height:n,style:r,viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg"},c.createElement("path",{d:"M1576 927l-1328 738q-23 13-39.5 3t-16.5-36v-1472q0-26 16.5-36t39.5 3l1328 738q23 13 23 31t-23 31z"}))},v=function(e){var t=e.width,n=e.height,r=e.style;return c.createElement("svg",{width:t,height:n,style:r,viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg"},c.createElement("path",{d:"M832 352v1088q0 26-19 45t-45 19-45-19l-333-333h-262q-26 0-45-19t-19-45v-384q0-26 19-45t45-19h262l333-333q19-19 45-19t45 19 19 45zm384 544q0 76-42.5 141.5t-112.5 93.5q-10 5-25 5-26 0-45-18.5t-19-45.5q0-21 12-35.5t29-25 34-23 29-36 12-56.5-12-56.5-29-36-34-23-29-25-12-35.5q0-27 19-45.5t45-18.5q15 0 25 5 70 27 112.5 93t42.5 142zm256 0q0 153-85 282.5t-225 188.5q-13 5-25 5-27 0-46-19t-19-45q0-39 39-59 56-29 76-44 74-54 115.5-135.5t41.5-173.5-41.5-173.5-115.5-135.5q-20-15-76-44-39-20-39-59 0-26 19-45t45-19q13 0 26 5 140 59 225 188.5t85 282.5zm256 0q0 230-127 422.5t-338 283.5q-13 5-26 5-26 0-45-19t-19-45q0-36 39-59 7-4 22.5-10.5t22.5-10.5q46-25 82-51 123-91 192-227t69-289-69-289-192-227q-36-26-82-51-7-4-22.5-10.5t-22.5-10.5q-39-23-39-59 0-26 19-45t45-19q13 0 26 5 211 91 338 283.5t127 422.5z"}))},y=function(e){var t=e.width,n=e.height,r=e.style;return c.createElement("svg",{width:t,height:n,style:r,viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg"},c.createElement("path",{d:"M1280 352v1088q0 26-19 45t-45 19-45-19l-333-333h-262q-26 0-45-19t-19-45v-384q0-26 19-45t45-19h262l333-333q19-19 45-19t45 19 19 45z"}))},w=function(e){var t=e.playbackHandler,n=e.paused,r={width:"20px",height:"20px",margin:"10px 10"};return c.createElement("div",{onClick:t,style:{height:"40px",border:"none",backgroundColor:"inherit",cursor:"pointer"}},n?c.createElement(g,{style:r}):c.createElement(f,{style:r}))},b=function(e){var t=e.time;return c.createElement("div",{style:{height:"40px",lineHeight:"40px",fontSize:"1rem",fontFamily:"Arial",width:230}},t)},x=function(e){var t=e.value,n=e.progressClickHandler;return c.createElement("progress",{onClick:n,min:"0",max:"100",value:t,style:{width:"calc(100% - 230px)",margin:"0 20px",height:"40px",cursor:"pointer"}})},E=function(e){var t,n=e.volumeHandler,r=e.muteHandler,o=e.volume,a=e.muted,i={width:"20px",height:"20px",margin:"10px 10"},s=(u(t={width:"calc(100% - 40px)",margin:"0 20px",height:"40px",cursor:"pointer"},"width","calc(30% - 40px)"),u(t,"opacity",a?.2:1),t);return c.createElement(c.Fragment,null,c.createElement("div",{onClick:r,style:{height:"40px",border:"none",backgroundColor:"inherit",cursor:"pointer"}},a?c.createElement(y,{style:i}):c.createElement(v,{style:i})),c.createElement("progress",{onClick:n,min:"0",max:"1",value:o,style:s}))},k=function(e){function t(e){var r;return i(this,t),u(p(p(r=h(this,d(t).call(this,e)))),"timeUpdateHandler",function(){var e=r.props.media,t=e.currentTime?e.currentTime/e.duration*100:0;r.setState({progress:t,timeString:r.getTimeString(e)})}),u(p(p(r)),"playbackListener",function(){var e=r.props.media;r.setState({paused:e.paused})}),u(p(p(r)),"playbackHandler",function(){var e=r.props.media;e.paused?e.play():e.pause(),r.setState({paused:!e.paused})}),u(p(p(r)),"progressClickHandler",function(e){var t=e.nativeEvent.offsetX/e.target.offsetWidth;r.changeMediaProgress(t)}),u(p(p(r)),"changeMediaProgress",function(e){var t=r.props.media;t.currentTime=e*t.duration,(t.paused||t.ended)&&t.play().then(function(){return t.pause()})}),u(p(p(r)),"muteHandler",function(){var e=r.props.media;e.muted=!e.muted,r.setState({muted:e.muted})}),u(p(p(r)),"volumeHandler",function(e){var t=r.props.media;t.volume=e.nativeEvent.offsetX/e.target.offsetWidth,r.setState({volume:t.volume})}),u(p(p(r)),"getTimeString",function(e){var t=r.secondsToHms(e.currentTime),n=r.secondsToHms(e.duration);return"".concat(t," / ").concat(n)}),u(p(p(r)),"secondsToHms",function(e){var t=Number(e);if(!e)return"00:00:00";var n=Math.floor(t/3600),r=Math.floor(t%3600/60),o=Math.floor(t%3600%60);return"".concat(n<10?"0".concat(n):n,":").concat(r<10?"0".concat(r):r,":").concat(o<10?"0".concat(o):o)}),r.state={paused:!0,muted:!1,volume:e.media.volume,timeString:r.getTimeString(e.media),progress:0},r}return o(t,c.Component),n(t,[{key:"componentDidMount",value:function(){var e=this.props.media;e.addEventListener("play",this.playbackListener,!1),e.addEventListener("pause",this.playbackListener,!1),e.addEventListener("timeupdate",this.timeUpdateHandler,!1)}},{key:"componentWillUnmount",value:function(){var e=this.props.media;e.removeEventListener("play",this.playbackListener,!1),e.removeEventListener("pause",this.playbackListener,!1),e.removeEventListener("timeupdate",this.timeUpdateHandler,!1)}},{key:"render",value:function(){var e=this.props.showProgressBar,t=this.state,n=t.paused,r=t.timeString,o=t.progress,a=t.volume,i=t.muted;return c.createElement("div",{style:{display:"flex",backgroundColor:"#d0d0d0",position:"relative",top:"-4px",width:"100%",height:"40px",justifyContent:"flex-start"}},c.createElement(w,{paused:n,playbackHandler:this.playbackHandler}),c.createElement(b,{time:r}),e&&c.createElement(x,{value:o,progressClickHandler:this.progressClickHandler}),c.createElement(E,{volumeHandler:this.volumeHandler,muteHandler:this.muteHandler,volume:a,muted:i}))}}]),t}();u(k,"defaultProps",{showProgressBar:!0});var C={minHeight:302,minWidth:500,padding:20,border:"1px solid #ccc",backgroundColor:"#fff"},S={minHeight:60,color:"#555",fontSize:20,marginBottom:20,backgroundColor:"#fff",border:"1px solid #aaa",borderRadius:4,padding:8,cursor:"pointer"},H=function(e){var t=e.comments,n=e.goToTimeMark;return c.createElement("div",{style:C},c.createElement("h3",{style:{marginLeft:"-10px",marginTop:"-10px",color:"#666"}},"Comments"),t.map(function(e){return e&&e.text?c.createElement("div",{style:S,onClick:function(){return n(e.progressMark)},key:"".concat(e.id)},e.text):null}))},q=function(e){function a(){var e,t;i(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return u(p(p(t=h(this,(e=d(a)).call.apply(e,[this].concat(r))))),"state",{visible:!1}),u(p(p(t)),"showPopup",function(){return t.setState({visible:!0})}),u(p(p(t)),"hidePopup",function(){return t.setState({visible:!1})}),u(p(p(t)),"confirmAction",function(){t.hidePopup(),t.props.successCallback(t.field.value),t.field.value=""}),u(p(p(t)),"cancelAction",function(){t.hidePopup(),t.props.cancelCallback()}),t}return o(a,c.Component),n(a,[{key:"render",value:function(){var t=this,e={width:"80px",height:"32px",fontSize:"14px",marginRight:20};return c.createElement("div",{style:{color:"#000",padding:20,border:"1px solid #888",borderRadius:4,background:"#fff",width:500,minHeight:500,position:"fixed",top:"20%",left:"calc(50% - 200px)",display:this.state.visible?"block":"none"},className:"modal-block"},c.createElement("div",{className:"modal-header"},c.createElement("h4",null,"Add comment")),c.createElement("div",{className:"general-block-body"},c.createElement("div",{style:{width:"100%",height:400,padding:20}},c.createElement("textarea",{style:{width:"100%",height:"100%",backgroundColor:"inherit",outline:"none",padding:15,fontSize:20,color:"#555"},ref:function(e){t.field=e}})),c.createElement("div",{className:"modal-footer",style:{padding:20}},c.createElement("button",{style:e,type:"button",className:"btn bottom-action double",onClick:this.cancelAction},"Cancel"),c.createElement("button",{style:e,type:"button",className:"btn bottom-action double",onClick:this.confirmAction},"Add"))))}}]),a}();return function(e){function a(){var e,n;i(this,a);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return u(p(p(n=h(this,(e=d(a)).call.apply(e,[this].concat(r))))),"state",{audio:null,progress:0,comments:[]}),u(p(p(n)),"controlsRef",c.createRef()),u(p(p(n)),"commentsModal",c.createRef()),u(p(p(n)),"audioProgressHandler",function(){var e=n.state.audio;if(e){var t=e.currentTime?e.currentTime/e.duration*100:0;n.setState({progress:t})}}),u(p(p(n)),"progressClickHandler",function(e){n.controlsRef&&n.controlsRef.changeMediaProgress(e)}),u(p(p(n)),"showCommentsPopup",function(){return n.commentsModal.showPopup()}),u(p(p(n)),"successCommentCallback",function(e){var t={id:n.state.comments.length?n.state.comments[n.state.comments.length-1].id+1:0,text:e,progressMark:n.state.progress/100};n.setState(function(e){return{comments:l(e.comments).concat([t])}})}),n}return o(a,c.Component),n(a,[{key:"componentDidMount",value:function(){var t=this,n=document.createElement("audio"),e=n.src.substr(n.src.lastIndexOf("."));n.src=this.props.src,n.type="audio/".concat(e);window.addEventListener("load",function e(){4===n.readyState?t.setState({audio:n}):setTimeout(e,100)},!1),n.load(),n.addEventListener("timeupdate",this.audioProgressHandler,!1)}},{key:"componentWillUnmount",value:function(){this.state.audio.removeEventListener("timeupdate",this.audioProgressHandler,!1)}},{key:"render",value:function(){var t=this,e=this.props,n=e.enableComments,r=e.showCommentsList,o=void 0===r||r;return c.createElement("div",{style:{width:"100%",display:"flex"}},c.createElement("div",null,c.createElement(m,s({progressClickHandler:this.progressClickHandler,progress:this.state.progress},this.props)),this.state.audio&&c.createElement(k,{showProgressBar:!1,ref:function(e){t.controlsRef=e},media:this.state.audio})),n&&c.createElement("aside",{style:{padding:20,paddingTop:0}},o&&c.createElement(H,{goToTimeMark:this.progressClickHandler,comments:this.state.comments}),c.createElement("button",{type:"button",style:{width:"100%",height:"48px",fontSize:"16px",marginTop:"12px"},onClick:this.showCommentsPopup},"Add comment"),c.createElement(q,{successCallback:this.successCommentCallback,ref:function(e){t.commentsModal=e}})))}}]),a}()});
